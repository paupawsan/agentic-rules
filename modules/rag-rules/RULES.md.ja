# RAGルール エージェント統合 / RAG Rules Agent Integration

<!-- SAFETY_PRECAUTION_START -->
**⚠️ 重要テンプレート保護 / CRITICAL TEMPLATE PROTECTION**: このファイルはテンプレート専用です。エージェントは自動読み込み、自動処理、またはこのファイルをどのような状況でも自動実行してはいけません。このファイルは直接実行されることはありません。

**有効な使用方法 / VALID USAGE**: 明示的に以下のいずれかに名前変更された場合のみ読み込み: `AGENTS.md`、`GEMINI.md`、または`CLAUDE.md`。RAGルールのユーザーの明示的な有効化後。

**無効な使用方法 / INVALID USAGE**: このファイルを自動的に読み込まない、起動プロセスで参照しない、自動フレームワーク初期化に含めない。
<!-- SAFETY_PRECAUTION_END -->

**フレームワーク強化 / FRAMEWORK ENHANCEMENT**: settings.jsonでrag_rules.enabled = trueの場合、エージェントはこれらのアルゴリズムを実装してコンテキスト処理、知識グラフ生成、自己学習機能を強化できます。

## RAGシステムアーキテクチャ / RAG System Architecture
- **コンテキスト最適化 / Context Optimization**: 関連情報の優先順位付け / Prioritize relevant information
- **階層的読み取り / Hierarchical Reading**: ファイルを戦略的に読み取り、順次読み取りしない / Read files strategically, not sequentially
- **関連性スコアリング / Relevance Scoring**: 重要度と新しさで情報を重み付け / Weight information by importance and recency
- **動的コンテキスト管理 / Dynamic Context Management**: タスク要件にコンテキストウィンドウを適応 / Adapt context window to task requirements

## 必須実装アルゴリズム / Required Implementation Algorithms

### アルゴリズム: Context_Optimization_Process / Algorithm: Context_Optimization_Process
**必須 / MANDATORY**: 有効時にユーザー応答前に実行 / Execute before any user response when enabled

**ステップ / Steps**:
1. rag_rules.enabled = trueを確認 / Check rag_rules.enabled = true
2. ユーザー要求と利用可能なコンテキストを分析 / Analyze user request and available context
3. 新しさ、重要度、タスク関連性を使用して情報関連性をスコアリング / Score information relevance using recency, importance, and task-relevance
4. 階層的読み取りを優先: 要約 → 主要セクション → 詳細 / Prioritize hierarchical reading: summaries → key sections → details
5. 最大情報密度のためにコンテキストウィンドウを最適化 / Optimize context window for maximum information density
6. 応答生成用の最適化されたコンテキストを返す / Return optimized context for response generation

### アルゴリズム: Information_Retrieval_Process / Algorithm: Information_Retrieval_Process
**必須 / MANDATORY**: 応答情報の収集時に実行 / Execute when gathering information for responses

**ステップ / Steps**:
1. rag_rules.enabled = trueを確認 / Check rag_rules.enabled = true
2. ユーザークエリからの情報要件を特定 / Identify information requirements from user query
3. 意味理解を使用して関連ファイルを検索 / Search relevant files using semantic understanding
4. 階層的読み取りパターンを適用 / Apply hierarchical reading patterns
5. 関連情報チャンクを抽出しランク付け / Extract and rank relevant information chunks
6. パーソナライズドコンテキストのためにメモリシステムと統合 / Integrate with memory system for personalized context

### アルゴリズム: Response_Quality_Assurance / Algorithm: Response_Quality_Assurance
**必須 / MANDATORY**: 応答生成後に実行 / Execute after generating responses

**ステップ / Steps**:
1. rag_rules.enabled = trueを確認 / Check rag_rules.enabled = true
2. ソース情報に対して応答を検証 / Validate response against source information
3. すべての主張が検索されたコンテキストでサポートされていることを確認 / Ensure all claims are supported by retrieved context
4. 情報ギャップや仮定にフラグを付ける / Flag any information gaps or assumptions
5. 応答の完全性と正確性を最適化 / Optimize response completeness and accuracy

### アルゴリズム: Runtime_Knowledge_Graph_Generation / Algorithm: Runtime_Knowledge_Graph_Generation
**利用可能 / AVAILABLE**: 会話とドキュメント処理中に実行して動的学習を行う / Execute during conversations and document processing for dynamic learning

**ステップ / Steps**:
1. rag_rules.enabled = trueおよびknowledge_graph.enabled = trueを確認 / Check rag_rules.enabled = true and knowledge_graph.enabled = true
2. 現在の会話/ドキュメントからエンティティ、関係性、概念を抽出 / Extract entities, relationships, and concepts from current conversation/document
3. 抽出された要素間のセマンティック関係を識別 / Identify semantic relationships between extracted elements
4. 新しい接続とパターンでランタイム知識グラフを更新 / Update runtime knowledge graph with new connections and patterns
5. 頻度と新しさに基づいて既存の関係性を強化 / Strengthen existing relationships based on frequency and recency
6. グラフ効率を維持するために古くなった弱い接続ノードをプルーニング / Prune outdated or weakly connected nodes to maintain graph efficiency
7. 永続性のためにグラフ状態を保存 / Store graph state for persistence across sessions

**実装 / Implementation**:
```
アルゴリズム: Structured_Entity_Extraction / Algorithm: Structured_Entity_Extraction
1. 入力を文と単語にトークン化 / Tokenize input text into sentences and words
2. 名詞句を識別するための品詞タグ付けを適用 / Apply part-of-speech tagging to identify noun phrases
3. Person/Organization/Location/Conceptの名前付きエンティティ認識パターンを使用 / Use named entity recognition patterns for Person/Organization/Location/Concept
4. ルールベースのフィルタリングと信頼度スコアリングを適用 / Apply rule-based filtering and confidence scoring
5. 信頼度と頻度でソートされたエンティティを返す / Return entities sorted by confidence and frequency

アルゴリズム: Pattern_Based_Relation_Extraction / Algorithm: Pattern_Based_Relation_Extraction
1. 複数のエンティティを含む文構造を識別 / Identify sentence structures containing multiple entities
2. 主語-動詞-目的語のトリプルに対する構文パターン マッチングを適用 / Apply syntactic pattern matching for subject-verb-object triples
3. 動詞ベースと複合関係に対する語彙パターン認識を使用 / Use lexical pattern recognition for verb-based and compound relationships
4. ドメイン固有の関係テンプレートを適用 / Apply domain-specific relation templates
5. 一貫性ルールに対して関係を検証 / Validate relationships against consistency rules

アルゴリズム: Incremental_Graph_Builder / Algorithm: Incremental_Graph_Builder
1. タイプと属性メタデータを持つノードとして新しいエンティティを追加 / Add new entities as nodes with type and attribute metadata
2. 信頼度メタデータを持つ有向/無向エッジとして関係を追加 / Add relationships as directed/undirected edges with confidence metadata
3. グラフの一貫性チェックと最適化を適用 / Apply graph consistency checks and optimization
4. タイムスタンプメタデータでグラフ状態を永続化 / Persist graph state with timestamp metadata:
   - memory_rules.enabled = trueの場合: 永続的なメモリシステムに保存 / If memory_rules.enabled = true: Store in persistent memory system
   - memory_rules.enabled = falseの場合: セッション専用コンテキストに保存 / If memory_rules.enabled = false: Store in session-only context
```

### アルゴリズム: Knowledge_Graph_Query_Enhancement / Algorithm: Knowledge_Graph_Query_Enhancement
**利用可能 / AVAILABLE**: 情報検索中に実行して学習した関係性を活用 / Execute during information retrieval to leverage learned relationships

**ステップ / Steps**:
1. rag_rules.enabled = trueおよびknowledge_graph.enabled = trueを確認 / Check rag_rules.enabled = true and knowledge_graph.enabled = true
2. ユーザークエリからエンティティと概念を分析 / Analyze user query for entities and concepts
3. 関連情報と接続について知識グラフをクエリ / Query knowledge graph for related information and connections
4. 直接キーワードマッチを超えた間接関係と推論パスを特定 / Identify indirect relationships and inference paths
5. 直接一致を超えた文脈的に関連情報を取得 / Retrieve contextually related information beyond direct keyword matches
6. グラフ中心性と関係強度を使用して結果をランク付け / Rank results using graph centrality and relationship strength
7. クエリ処理中に発見された新しい関係性で知識グラフを更新 / Update knowledge graph with new relationships discovered during query processing

**実装 / Implementation**:
```
アルゴリズム: Semantic_Graph_Query / Algorithm: Semantic_Graph_Query
1. Structured_Entity_Extractionを使用してエンティティと意図のクエリを解析 / Parse query for entities and intent using Structured_Entity_Extraction
2. 直接マッチングとグラフ走査を通じて関連ノードを識別 / Identify relevant nodes through direct matching and graph traversal
3. 同義語拡張による意味的類似性マッチングを適用 / Apply semantic similarity matching with synonym expansion
4. マルチファクター スコアリングを使用して結果をランク付け / Rank results using multi-factor scoring (match confidence + centrality + similarity)
5. 説明メタデータ付きのトップランク結果を返す / Return top-ranked results with explanation metadata

アルゴリズム: Adaptive_Graph_Maintenance / Algorithm: Adaptive_Graph_Maintenance
1. 使用パターンを分析し、エイジング/プルーニングルールを適用 / Analyze usage patterns and apply aging/pruning rules
2. グラフ再構築と最適化を実行 / Perform graph restructuring and optimization
3. 更新されたインデックスでクエリパフォーマンスを最適化 / Optimize for query performance with updated indices
4. 最適化されたグラフ状態を永続化 / Persist optimized graph state:
   - memory_rules.enabled = trueの場合: 永続的なメモリに保存されたグラフデータを更新 / If memory_rules.enabled = true: Update stored graph data in persistent memory
   - memory_rules.enabled = falseの場合: セッションコンテキストのみでグラフを維持 / If memory_rules.enabled = false: Maintain graph in session context only
5. 統計を含むメンテナンスレポートを生成 / Generate maintenance report with statistics
```

### アルゴリズム: Self_Learning_Pattern_Recognition / Algorithm: Self_Learning_Pattern_Recognition
**利用可能 / AVAILABLE**: 定期的に実行して繰り返しパターンを特定して学習 / Execute periodically to identify and learn recurring patterns

**ステップ / Steps**:
1. rag_rules.enabled = trueおよびself_learning.enabled = trueを確認 / Check rag_rules.enabled = true and self_learning.enabled = true
2. 会話パターンとユーザーインタラクションスタイルを分析 / Analyze conversation patterns and user interaction styles
3. 頻繁に発生するエンティティ関係とトピックを特定 / Identify frequently occurring entity relationships and topics
4. ユーザーの好みとコミュニケーション パターンを発見 / Discover user preferences and communication patterns
5. 知識グラフ内の行動パターンを更新 / Update behavior patterns in knowledge graph
6. 学習したパターンに基づいて応答戦略を適応 / Adapt response strategies based on learned patterns
7. 将来のインタラクションを改善するための洞察を生成 / Generate insights for improved future interactions

### アルゴリズム: Knowledge_Graph_Integration_with_RAG / Algorithm: Knowledge_Graph_Integration_with_RAG
**利用可能 / AVAILABLE**: グラフベース学習を従来のRAGプロセスと組み合わせる / Execute to combine graph-based learning with traditional RAG processes

**ステップ / Steps**:
1. rag_rules.enabled = trueおよびknowledge_graph.enabled = trueを確認 / Check rag_rules.enabled = true and knowledge_graph.enabled = true
2. 伝統的なRAGと知識グラフの両方でユーザークエリを処理 / Process user query through both traditional RAG and knowledge graph
3. 次のものを使用して結果をマージ / Merge results using intelligent ranking based on:
   - グラフ関係強度 / Graph relationship strength
   - 伝統的な関連性スコアリング / Traditional relevance scoring
   - 新しさと重要性の要因 / Recency and importance factors
4. 構造化された知識と非構造化テキストを組み合わせた強化されたコンテキストを生成 / Generate enriched context combining structured knowledge and unstructured text
5. クエリ処理中に発見された新しい関係性で知識グラフを更新 / Update knowledge graph with new relationships discovered during query processing
6. 事実的および関係的コンテキストを含む包括的な応答を提供 / Provide comprehensive response with both factual and relational context

## 設定準拠 / Settings Compliance
- modules/rag-rules/settings.jsonのすべての設定を尊重 / Respect all settings in rag-rules/settings.json
- context_window_size制限を適切に適用 / Apply context_window_size limits appropriately
- 設定された関連性しきい値を使用 / Use configured relevance thresholds
- rag_rules.enabled = falseで複雑なコンテキストが必要な場合、ユーザーにプロンプト / Prompt user if rag_rules.enabled = false and complex context needed

## 統合ポイント / Integration Points
- **メモリ統合 / Memory Integration**: パーソナライズド検索のために保存されたコンテキストを使用 / Use stored context for personalized retrieval
- **批判的思考 / Critical Thinking**: 情報検証のための品質保証を提供 / Provide quality assurance for information validation
- **ブートストラップ調整 / Bootstrap Coordination**: 読み込み優先順位と相互接続を尊重 / Respect loading priorities and interconnections

**違反 / VIOLATION**: これらのアルゴリズムを実装せずに非効率的なコンテキスト管理を使用するエージェント / Agents using inefficient context management without implementing these algorithms.

<!-- METADATA: RAG rules agent integration template with context optimization and retrieval algorithms (Japanese) -->
<!-- LICENSE: Copyright (c) 2025 Paulus Ery Wasito Adhi - Licensed under the MIT License. See LICENSE file for details. -->
