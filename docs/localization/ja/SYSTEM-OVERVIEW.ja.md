# 🔧 Agentic Rules Framework - システムの説明 (日本語)

## システムの仕組み

このドキュメントでは、Agentic Rules Frameworkの仕組み、基本原則、実装の詳細を説明します。

## 🏗️ 基本構造

### フレームワークの基本考え方

Agentic Rules Frameworkは3つの基本原則に基づいて作られています：

#### 1. **分散型ルールシステム**
- **中央制御なし**: 各ルールが自分の担当領域で独立して動作
- **柔軟なつながり**: ルール同士は共有データで通信し、直接呼び出しではない
- **障害の隔離**: 1つのルールに問題が起きても他の部分に影響しない
- **モジュール式**: 新しいルールを追加しても既存のものを変える必要がない

#### 2. **賢い行動ガイドライン**
- **厳しい制限ではない**: ルールは厳しい制限ではなく、行動の指針を提供
- **ツールを選ばない**: AIは使えるツールを使ってルールに従う
- **柔軟な実装**: ルールに従う方法が複数ある
- **段階的な強化**: ルールは既存の機能を少しずつ良くする

#### 3. **独立して動作**
- **外部ソフト不要**: フレームワークは追加インストールなしで動作
- **オフラインOK**: すべての部品が1つのHTMLファイルに含まれる
- **持ち運びやすい設定**: 簡単な導入のためのJSONベース設定
- **複数プラットフォーム対応**: 異なるAI環境に適応可能

### 部品の構成

```
フレームワーク層
├── 初期設定 (bootstrap.json)
├── Webインターフェース (setup.html)
├── コマンドラインツール (setup.py, setup-launcher.py)
└── 多言語システム (localization.json)

ルール層
├── メモリールール (modules/memory-rules/)
├── RAGルール (modules/rag-rules/)
└── 批判的思考ルール (modules/critical-thinking-rules/)

実装層
├── ルールテンプレート (RULES.md.*)
├── 設定の構造 (settings.json)
├── セットアップ情報 (setup.json)
└── 生成された統合ファイル (AGENTS.md)
```

## 🔄 フレームワークの動作フロー

### 1. 初期設定フェーズ
```
bootstrap.jsonを読み込み → 設定を確認 → ルールの読み込み順序を準備
```

**主な作業:**
- 設定の確認と一貫性チェック
- ルールの依存関係を整理して優先順位付け
- 各プラットフォーム向けの調整を準備
- セキュリティと権限のセットアップ

### 2. ルール準備フェーズ
```
有効にした各ルール → 設定を読み込み → 設定を確認 → 動作ルールを準備
```

**各ルールごとの処理:**
- `settings.json`からルール固有の設定を読み込み
- 設定が正しい構造か確認
- データ構造と一時保存領域を準備
- 他のルールとのつながりを確立

### 3. 通常動作フェーズ
```
ユーザーとのやり取り → ルールを実行 → 結果を調整 → 回答を作成
```

**連携して動作:**
- ルールがそれぞれの担当領域で同時に動作
- 結果は初期設定を通じてまとめられる
- ルール間の整合性を確認
- 回答を最適化して最終決定

## 📋 技術仕様

### 初期設定の構造

```json
{
  "_info": {
    "version": "1.0.0",
    "compatibility": ["cursor", "vscode", "custom"],
    "license": "MIT"
  },
  "loading_sequence": [
    "memory-rules",
    "rag-rules",
    "critical-thinking-rules"
  ],
  "hubungan_antar_aturan": {
    "memory_rag_sharing": true,
    "critical_memory_learning": true,
    "rag_critical_validation": true
  },
  "penyesuaian_platform": {
    "cursor": { /* Cursor固有設定 */ },
    "vscode": { /* VSCode固有設定 */ }
  }
}
```

### ルール設定スキーマ

```json
{
  "_metadata": {
    "rule_name": "memory-rules",
    "version": "1.0.0",
    "compatibility": ["cursor", "vscode"],
    "dependencies": ["rag-rules"]
  },
  "mandatory_config": [
    {
      "name": "storage_path",
      "type": "path",
      "validation": "writable_directory"
    }
  ],
  "optional_config": [
    {
      "name": "retention_days",
      "type": "number",
      "default": 90,
      "range": [30, 365]
    }
  ]
}
```

### 生成統合フォーマット

```
# ルールタイトル

**⚠️ 安全対策**: テンプレート有効化が必要

**必須**: 実装要件

## アルゴリズム仕様

### アルゴリズム: Process_Name
**必須**: 実行条件

**ステップ**:
1. ステップバイステップ実装
2. 検証要件
3. エラーハンドリング手順

**設定準拠**: 設定統合
```

## 🔗 ルール同士の連携

### メモリ ↔ RAG連携

**情報流れ:**
```
ユーザー質問 → RAGで文脈検索 → メモリで個人化 → 強化された文脈 → 回答作成
```

**共有するもの:**
- 文脈の理解と関連性のスコア
- メモリからのユーザーの好みパターン
- 過去の成功に基づく検索方法の改善

### 批判的思考 ↔ メモリ連携

**改善サイクル:**
```
回答作成 → 批判的に分析 → エラー発見 → メモリに保存 → 将来の改善
```

**品質確保:**
- 保存された情報の正確性確認
- 修正学習とパターン認識
- 過去の実績に基づく信頼度調整

### RAG ↔ 批判的思考連携

**検証プロセス:**
```
情報検索 → 批判的に確認 → 出典検証 → 信頼度評価 → 回答の資格
```

**品質チェック:**
- 出典の信頼性評価
- 論理的一貫性検証
- 仮定のテストと検証

## 🧠 Knowledge Graph (KG) アーキテクチャ

### KG 構築パイプライン

フレームワークはプロジェクトコンポーネント間のセマンティック関係を自動的に構築する高度な Knowledge Graph 構築システムを実装します。

#### コア KG アルゴリズム

**1. 構造化エンティティ抽出**
```python
アルゴリズム: コードベースからエンティティを抽出
Input: ソースコード、文書化、設定ファイル
Process:
├── トークン化と POS タグ付け
├── 名前付きエンティティ認識 (NER)
├── ドメイン固有パターンマッチング
├── 信頼度スコアリングと検証
Output: カテゴライズされたエンティティ (関数、クラス、ファイル、概念)
```

**2. パターンベース関係発見**
```python
アルゴリズム: エンティティ間の関係を特定
Input: エンティティリスト、文脈情報
Process:
├── 構文パターンマッチング (主語-動詞-目的語)
├── 依存関係分析 (インポート、呼び出し、継承)
├── セマンティックリンク (概念関係)
├── 時間的関係検出
Output: 信頼度スコア付きの型付き関係
```

**3. インクリメンタルグラフビルダー**
```python
アルゴリズム: Knowledge Graph の構築と維持
Input: 新しいエンティティ、関係、既存グラフ、メモリシステム有効化
Process:
├── 既存ノードとエッジでグラフを初期化
├── エンティティの重複排除とマージ
├── 関係の一貫性検証
├── グラフの最適化とインデックス作成
├── メタデータ付きグラフ状態の永続化
Output: クエリインターフェース付き更新 KG
```

### KG アーキテクチャコンポーネント

#### **グラフストレージ層**
```
メモリシステム統合:
├── プライマリストレージ: /lm/projects/{project}/kg/
├── バックアップストレージ: /lm/common/knowledge_graph/
├── メタデータストレージ: グラフ構築タイムスタンプ、バージョン
├── クエリインデックス: 関係トラバーサル用最適化
```

#### **クエリ処理エンジン**
```
セマンティッククエリ処理:
├── 自然言語 → エンティティ/インテント解析
├── グラフトラバーサルアルゴリズム (BFS/DFS と深さ制限)
├── 関係フィルタリングとランキング
├── 接続ノードからのコンテキスト拡張
├── 多要素スコアリングによる結果ランキング
```

#### **バックグラウンド処理アーキテクチャ**
```
非同期 KG 構築:
├── トリガー検出: プロジェクト分析、ファイル変更、ユーザークエリ
├── バッチ処理: 設定可能なチャンクでのエンティティ抽出
├── インクリメンタル更新: 変更されたコンポーネントのみ処理
├── リソース管理: CPU/メモリ制限、タイムアウト制御
├── 永続化キュー: ユーザーインタラクションをブロックせずに結果保存
```

### ルールシステムとの KG 統合

#### **RAG ルール ↔ KG 統合**
```
情報検索強化:
├── 従来の RAG: キーワードベースドキュメント検索
├── KG 強化 RAG: セマンティック関係トラバーサル
├── ハイブリッドスコアリング: キーワード関連性 + グラフ中心性結合
├── コンテキスト拡張: 関連概念と依存関係を含む
```

#### **メモリルール ↔ KG 統合**
```
永続知識ストレージ:
├── KG 構造: 特殊メモリカテゴリに保存
├── 関係保存: セッション全体でグラフトポロジ維持
├── クエリ履歴: 成功した KG クエリから学習
├── コンテキストリンク: KG 洞察を会話コンテキストに接続
```

#### **クリティカルシンキング ↔ KG 統合**
```
知識検証:
├── ソース検証: 既知事実に対する KG 関係チェック
├── 一貫性分析: 論理的競合に対するグラフ関係検証
├── 不確実性定量化: グラフ要素に信頼度スコア割り当て
├── エラー検出: 潜在的に不正確な関係の特定
```

### KG パフォーマンス特性

#### **スケーラビリティメトリクス**
```
現在のベースライン (28 ノード、47 関係):
├── 構築時間: プロジェクト分析で <30 秒
├── クエリパフォーマンス: 平均応答時間 <250ms
├── メモリ使用量: プロジェクト KG データで ~135KB
├── 更新頻度: 変更によりトリガーされる増分

成長予測 (50 ノード、100 関係):
├── 構築時間: バッチ処理で <45 秒
├── クエリパフォーマンス: 最適化インデックスで <500ms
├── メモリ使用量: 圧縮で ~250KB
├── リアルタイム更新: パフォーマンス維持のためのバックグラウンド処理
```

#### **品質保証**
```
グラフ検証:
├── エンティティ精度: 正しいコンポーネント識別 >95%
├── 関係精度: 正確な関係マッピング >90%
├── グラフ一貫性: 自動競合解決
├── クエリ関連性: セマンティックマッチングとキーワード検索へのフォールバック
```

### KG 視覚化 & 分析

#### **ASCII グラフ表現**
```
フレームワークアーキテクチャ KG:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ルールモジュール │◄───┤   セットアップシステム │◄───┤   メモリシステム │
│                 │    │                 │    │                 │
│ • RAG ルール    │    │ • setup.py      │    │ • /lm/ ストレージ│
│ • メモリルール  │    │ • setup.html    │    │ • カテゴリ      │
│ • クリティカルシンキング│  │ • web-config   │    │ • 永続性      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        ▲                        ▲                        ▲
        │                        │                        │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ ドキュメンテーション │◄───┤   ローカライズ    │◄───┤ コンフィグレーション │
│                 │    │                 │    │                 │
│ • README.md     │    │ • JSON ファイル  │    │ • settings.json │
│ • ガイド        │    │ • 多言語         │    │ • bootstrap.json│
│ • API ドキュメント│    │ • 翻訳          │    │ • 環境          │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### **関係タイプ凡例**
- **───**: 直接依存関係 (強い結合)
- **◄───**: データフロー関係
- **····**: 間接的またはオプションの関係
- **━━━━**: クリティカルパスまたは主要ワークフロー

### KG クエリインターフェース

#### **サポートされるクエリタイプ**
```
1. 構造クエリ: "X に接続されたすべてのコンポーネントを見つける？"
2. 関係クエリ: "A と B はどのように接続されていますか？"
3. パターンクエリ: "Y に似た構造を見つける"
4. 影響分析: "Z を変更すると何が壊れますか？"
5. ナビゲーションクエリ: "A から B へのパスを表示"
```

#### **クエリ処理パイプライン**
```
自然言語クエリ → インテント分類 → エンティティ解決 → グラフトラバーサル → 結果ランキング → 応答合成
```

### KG メンテナンス & 進化

#### **自動更新**
- **変更検出**: ファイルシステム監視による修正
- **増分更新**: 影響を受けるグラフ部分のみ再構築
- **バージョン管理**: コードと共に KG 進化を追跡
- **パフォーマンス監視**: クエリパフォーマンスと精度メトリクス

#### **品質メンテナンス**
- **一貫性チェック**: 定期的なグラフ関係検証
- **正確性検証**: ソースコードとのクロスリファレンス
- **パフォーマンスチューニング**: クエリパターンとインデックスの最適化
- **ユーザーフィードバック統合**: クエリ成功/失敗パターンからの学習

## 🌍 複数プラットフォーム対応

### プラットフォーム調整システム

```json
{
  "platform_adapters": {
    "cursor": {
      "file_system": "cursor_workspace",
      "tool_integration": "cursor_tools",
      "memory_persistence": "cursor_storage"
    },
    "vscode": {
      "file_system": "workspace_folders",
      "tool_integration": "vscode_extensions",
      "memory_persistence": "workspace_settings"
    },
    "custom": {
      "file_system": "configurable_paths",
      "tool_integration": "api_endpoints",
      "memory_persistence": "custom_storage"
    }
  }
}
```

### 環境認識

**自動プラットフォーム検出:**
- ファイルシステムの構造を分析
- 利用可能なツールを検出
- 設定ファイルの存在を確認
- 実行時の環境変数をチェック

## 🔒 セキュリティと安全システム

### 安全対策

#### テンプレート有効化の安全
- **自動読み込みなし**: ルールはユーザーが明確に有効化する必要がある
- **テンプレート印**: 誤って有効化しないための明確な目印
- **ユーザー同意**: ルール有効化に明確な確認が必要

#### ランタイム安全
- **エラー隔離**: ルール障害がシステム動作から隔離
- **リソース制限**: 設定可能なタイムアウトとリソース制約
- **監査ログ**: すべてのルール操作がログに記録

### データ保護

#### メモリセキュリティ
- **暗号化オプション**: 機密データを暗号化可能
- **アクセス制御**: メモリカテゴリごとに異なる権限レベル
- **保持ポリシー**: 期限切れデータの自動クリーンアップ

#### 設定セキュリティ
- **検証**: すべての設定がスキーマに対して検証
- **サニタイズ**: 入力検証とサニタイズ
- **バックアップ**: 設定変更前の自動バックアップ

## 📊 パフォーマンスアーキテクチャ

### 最適化戦略

#### メモリ管理
- **遅延読み込み**: コンポーネントをオンデマンドで読み込み
- **キャッシュレイヤー**: パフォーマンスのためのマルチレベルキャッシュ
- **圧縮**: 大規模データセットの自動圧縮
- **インデックス化**: 高速検索のための最適化インデックス

#### 処理最適化
- **並行実行**: 可能な場合にルールを並行実行
- **バッチ処理**: 効率のためのグループ操作
- **段階的読み込み**: 重要なコンポーネントを最初に読み込み
- **バックグラウンドタスク**: 非ブロックバックグラウンド操作

### スケーラビリティ考慮事項

#### リソーススケーリング
- **メモリ制限**: 設定可能なメモリ使用制限
- **処理タイムアウト**: 設定可能な操作タイムアウト
- **ストレージクォータ**: 設定可能なストレージサイズ制限
- **同時操作**: 同時操作の制限

## 🔧 開発と拡張

### 新しいルールの追加

**ステップバイステッププロセス:**

1. **ディレクトリ作成**: `mkdir new-rule-rules/`
2. **テンプレート開発**: アルゴリズム付きの`RULES.md.en`を作成
3. **設定スキーマ**: `settings.json`と`setup.json`を定義
4. **ローカライズ**: `localization.json`に文字列を追加
5. **Bootstrap統合**: `bootstrap.json`の読み込みシーケンスに追加
6. **Webインターフェース**: `generate_simple_setup.py`を実行してUIを更新
7. **テスト**: すべてのサポートプラットフォームで検証

### ルール開発ガイドライン

#### アルゴリズム設計
- **明確な目標**: 各アルゴリズムが具体的で測定可能な目標を持つ
- **実装柔軟性**: 複数の実装アプローチを許可
- **エラーハンドリング**: 包括的なエラー検出と回復
- **パフォーマンス意識**: 効率的なリソース使用の考慮

#### 設定設計
- **段階的開示**: シンプルなデフォルトと高度なオプション
- **検証**: 包括的な入力検証とエラーメッセージ
- **ドキュメント**: 各設定オプションの明確な説明
- **互換性**: 既存設定との後方互換性

### 品質保証

#### テスト要件
- **ユニットテスト**: 個別アルゴリズムテスト
- **統合テスト**: ルール間インタラクションテスト
- **プラットフォームテスト**: すべてのサポートプラットフォームでのテスト
- **パフォーマンステスト**: 負荷とパフォーマンス検証

#### 検証チェック
- **スキーマ準拠**: すべての設定が定義されたスキーマに一致
- **ローカライズカバレッジ**: すべてのユーザー向け文字列がローカライズ
- **ドキュメント完全性**: すべての機能がドキュメント化
- **互換性**: 既存統合に対する破壊的変更なし

## 📈 進化と保守

### バージョン互換性

**セマンティックバージョニング:**
- **MAJOR**: ルールインターフェースまたはbootstrapフォーマットの破壊的変更
- **MINOR**: 新機能とルール追加
- **PATCH**: バグ修正とパフォーマンス改善

### 後方互換性

**移行戦略:**
- **設定移行**: ユーザー設定の自動移行
- **ルール互換性**: 新しいルールが既存統合を破壊しない
- **プラットフォームサポート**: プラットフォームバージョン間での互換性維持

### 非推奨ポリシー

**優雅な移行:**
- **警告期間**: 非推奨機能が警告を発行
- **移行ツール**: 自動移行支援
- **サポートタイムライン**: 非推奨機能の最小6ヶ月のサポート

## 🔬 研究とイノベーション

### 現在の研究領域

#### 高度なメモリシステム
- **セマンティックメモリ**: 理解ベースの保存と検索
- **エピソードメモリ**: 時間的関係を持つイベントベースメモリ
- **手続きメモリ**: プロセスとワークフローメモリ
- **感情メモリ**: ユーザー感情とプリファレンス学習

#### 強化推論
- **因果推論**: 原因と結果の関係の理解
- **類似推論**: パターン認識と適用
- **仮説推論**: 仮説生成とテスト
- **メタ推論**: 推論プロセスについての推論

#### コンテキスト最適化
- **動的コンテキストウィンドウ**: 適応コンテキストサイジング
- **マルチモーダル統合**: テキスト、コード、視覚コンテキスト
- **リアルタイム適応**: 会話中のコンテキスト調整
- **パーソナライズ**: ユーザー固有のコンテキスト最適化

### 将来の方向性

#### 自律学習
- **自己改善**: 自分自身を学習・最適化するルール
- **ユーザー適応**: インタラクションパターンに基づく深いパーソナライズ
- **クロスセッションレーニング**: すべてのユーザーインタラクションにわたる知識蓄積

#### 高度統合
- **マルチエージェント調整**: エージェント協力を 위한ルール
- **外部API統合**: サードパーティサービス統合のためのルール
- **リアルタイム協働**: マルチユーザー環境のためのルール

---

## 📚 追加リソース

- **[../README.md](../README.md)** - クイックスタートと概要
- **[../CORE-RULES.md](../CORE-RULES.md)** - フレームワーク原則
- **[USER-GUIDE.md](USER-GUIDE.md)** - エンドユーザーセットアップガイド
- **[DEVELOPER-GUIDE.md](DEVELOPER-GUIDE.md)** - 技術実装ガイド
- **[EXTENSION-MANUAL.md](EXTENSION-MANUAL.md)** - フレームワーク拡張ガイド

---

**🔧 システム概要**: Agentic Rules Frameworkの包括的な技術アーキテクチャと設計原則。

*Copyright (c) 2025 Paulus Ery Wasito Adhi. MIT Licenseの下でライセンスされています。*